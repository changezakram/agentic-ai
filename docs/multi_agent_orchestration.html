<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Multi-Agent Orchestration in Banking: Building Intelligent Workflows at Scale</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://changezakram.github.io/"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Changez Akram</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-generative-ai" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Generative AI</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-generative-ai">    
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/index.html">
 <span class="dropdown-text">Gen AI Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/vae.html">
 <span class="dropdown-text">Variational Autoencoders (VAEs)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/flows.html">
 <span class="dropdown-text">Normalizing Flows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/ebm.html">
 <span class="dropdown-text">Energy-Based Models (EBMs)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/diffusion.html">
 <span class="dropdown-text">Diffusion Models</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-large-language-models" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Large Language Models</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-large-language-models">    
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/transformers.html">
 <span class="dropdown-text">Transformers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/post-training.html">
 <span class="dropdown-text">Post Training</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/nlp-eval.html">
 <span class="dropdown-text">NLP Evaluation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-agentic-ai" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Agentic AI</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-agentic-ai">    
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/agentic-ai/agentic-ai.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/agentic-ai/agentic-analytics.html">
 <span class="dropdown-text">Agentic Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/slm.html">
 <span class="dropdown-text">Small Language Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/agentic-ai/agentic_ai_safety.html">
 <span class="dropdown-text">Building Safe &amp; Secure Agentic AI</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ai-strategy" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">AI Strategy</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ai-strategy">    
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/gen-ai-use-cases/ai_first_bank.html">
 <span class="dropdown-text">Building the AI-First Bank</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/gen-ai-use-cases/banking-use-cases.html">
 <span class="dropdown-text">Gen AI in Banking</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/Deep-Generative-Models/gen-ai-use-cases/healthcare-use-cases.html">
 <span class="dropdown-text">Gen AI in Healthcare</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-math-review" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Math Review</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-math-review">    
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/math-review/linear-algebra.html">
 <span class="dropdown-text">Linear Algebra</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/math-review/calculus.html">
 <span class="dropdown-text">Calculus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://changezakram.github.io/math-review/probability.html">
 <span class="dropdown-text">Probability</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#why-single-agents-arent-enough" id="toc-why-single-agents-arent-enough" class="nav-link active" data-scroll-target="#why-single-agents-arent-enough"><span class="header-section-number">1</span> Why Single Agents Aren’t Enough</a></li>
  <li><a href="#the-four-orchestration-patterns" id="toc-the-four-orchestration-patterns" class="nav-link" data-scroll-target="#the-four-orchestration-patterns"><span class="header-section-number">2</span> The Four Orchestration Patterns</a></li>
  <li><a href="#model-context-protocol---the-agent-language" id="toc-model-context-protocol---the-agent-language" class="nav-link" data-scroll-target="#model-context-protocol---the-agent-language"><span class="header-section-number">3</span> Model Context Protocol - The Agent Language</a></li>
  <li><a href="#orchestration-architecture---the-control-center" id="toc-orchestration-architecture---the-control-center" class="nav-link" data-scroll-target="#orchestration-architecture---the-control-center"><span class="header-section-number">4</span> Orchestration Architecture - The Control Center</a></li>
  <li><a href="#deep-dive-use-case---corporate-loan-origination" id="toc-deep-dive-use-case---corporate-loan-origination" class="nav-link" data-scroll-target="#deep-dive-use-case---corporate-loan-origination"><span class="header-section-number">5</span> Deep-Dive Use Case - Corporate Loan Origination</a></li>
  <li><a href="#governance-for-multi-agent-systems" id="toc-governance-for-multi-agent-systems" class="nav-link" data-scroll-target="#governance-for-multi-agent-systems"><span class="header-section-number">6</span> Governance for Multi-Agent Systems</a></li>
  <li><a href="#vendor-landscape-build-vs.-buy" id="toc-vendor-landscape-build-vs.-buy" class="nav-link" data-scroll-target="#vendor-landscape-build-vs.-buy"><span class="header-section-number">7</span> Vendor Landscape &amp; Build vs.&nbsp;Buy</a></li>
  <li><a href="#common-pitfalls-to-avoid" id="toc-common-pitfalls-to-avoid" class="nav-link" data-scroll-target="#common-pitfalls-to-avoid"><span class="header-section-number">8</span> Common Pitfalls to Avoid</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multi-Agent Orchestration in Banking: Building Intelligent Workflows at Scale</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="why-single-agents-arent-enough" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="why-single-agents-arent-enough"><span class="header-section-number">1</span> Why Single Agents Aren’t Enough</h2>
<p>A credit approval agent that operates in isolation isn’t autonomous—it’s blind. It can’t see the compliance agent’s sanctions screening, the pricing agent’s market analysis, or the risk agent’s portfolio exposure. The result: decisions made with incomplete context.</p>
<p><strong>Key Points:</strong> - Real banking workflows require 3-10 agents working together - The coordination challenge: context sharing, state management, error handling, human escalation - Why this matters NOW: LLMs can reason, but orchestration determines whether they’re useful or chaotic</p>
<p>The question isn’t whether to use multiple agents—it’s how to orchestrate them.</p>
<hr>
</section>
<section id="the-four-orchestration-patterns" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="the-four-orchestration-patterns"><span class="header-section-number">2</span> The Four Orchestration Patterns</h2>
<p>Frame each pattern with: 1. Pattern name + visual metaphor 2. Banking use case (specific, detailed) 3. When to use it 4. Governance consideration</p>
<section id="pattern-1-sequential-pipeline" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="pattern-1-sequential-pipeline"><span class="header-section-number">2.1</span> Pattern 1: Sequential Pipeline</h3>
<p><strong>Metaphor:</strong> Assembly line</p>
<p><strong>Use Case:</strong> Consumer loan origination - Application Intake Agent → Document Verification Agent → Credit Analysis Agent → Compliance Check Agent → Pricing Agent → Approval Agent - <strong>Detail the handoffs:</strong> - Application Intake extracts structured data from forms/documents - Document Verification confirms income statements, IDs, credit reports - Credit Analysis generates risk score + debt-to-income ratio - Compliance runs sanctions screening + fair lending checks - Pricing determines rate based on risk + market conditions - Approval makes final decision within policy limits</p>
<p><strong>When to use:</strong> Linear dependencies, each step requires previous step’s output</p>
<p><strong>Governance:</strong> Each agent logs decision + reasoning, human review triggers on exceptions (DTI &gt; 43%, sanctions hit, rate outside policy bounds)</p>
</section>
<section id="pattern-2-parallel-fan-outfan-in" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="pattern-2-parallel-fan-outfan-in"><span class="header-section-number">2.2</span> Pattern 2: Parallel Fan-Out/Fan-In</h3>
<p><strong>Metaphor:</strong> Simultaneous investigations</p>
<p><strong>Use Case:</strong> AML investigation (from Deloitte example) - <strong>Fan-out:</strong> Alert triggers → 3 agents activate simultaneously: - Transaction Pattern Agent (analyzes velocity, structuring, round-dollar amounts) - Entity Analysis Agent (beneficial ownership, related parties, shell companies) - External Data Agent (adverse media, sanctions lists, PEP databases) - <strong>Fan-in:</strong> All findings merge → Risk Scoring Agent assigns final suspicion score → Documentation Agent generates SAR if threshold exceeded</p>
<p><strong>When to use:</strong> Independent analyses that can run concurrently</p>
<p><strong>Governance:</strong> Each agent must complete before final decision, timeouts trigger human review</p>
</section>
<section id="pattern-3-hierarchical-supervisor-worker" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="pattern-3-hierarchical-supervisor-worker"><span class="header-section-number">2.3</span> Pattern 3: Hierarchical Supervisor-Worker</h3>
<p><strong>Metaphor:</strong> Orchestra conductor</p>
<p><strong>Use Case:</strong> Treasury operations - <strong>Supervisor Agent:</strong> Receives mandate (e.g., “Optimize liquidity for Q4 tax payment”) - <strong>Delegates to workers:</strong> - Cash Forecasting Agent (projects inflows/outflows across accounts) - FX Hedging Agent (analyzes currency exposure, recommends hedges) - Investment Agent (suggests short-term investment vehicles for excess cash) - Regulatory Reporting Agent (ensures liquidity coverage ratio compliance) - <strong>Supervisor:</strong> Aggregates recommendations, resolves conflicts (e.g., invest vs.&nbsp;hedge), executes coordinated plan</p>
<p><strong>When to use:</strong> Complex workflows requiring dynamic task allocation, conflicting objectives</p>
<p><strong>Governance:</strong> Supervisor maintains audit trail of delegation decisions, workers cannot execute without supervisor approval</p>
</section>
<section id="pattern-4-event-driven-reactive" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="pattern-4-event-driven-reactive"><span class="header-section-number">2.4</span> Pattern 4: Event-Driven Reactive</h3>
<p><strong>Metaphor:</strong> Smoke alarm</p>
<p><strong>Use Case:</strong> Autonomous mortgage refinancing - <strong>Trigger:</strong> Fed rate cut detected - <strong>Agent cascade:</strong> - Market Monitoring Agent → triggers Eligibility Agent (identifies customers with rates &gt;X% above new market rate) - Portfolio Agent → assesses bank’s capacity to refinance (balance sheet, servicing capacity) - Offer Generation Agent → creates personalized offers for eligible customers - Notification Agent → sends offers via customer’s preferred channel - Follow-up Agent → tracks responses, schedules advisor calls</p>
<p><strong>When to use:</strong> Continuous monitoring, opportunistic workflows</p>
<p><strong>Governance:</strong> Rate limits (max offers/day), exposure limits (max refinance volume), mandatory human approval for high-value customers</p>
<blockquote class="blockquote">
<p><strong>Key Insight:</strong> Most banks will use ALL four patterns simultaneously. Consumer lending runs sequential pipelines. Risk management uses parallel fan-out. Treasury uses hierarchical coordination. Customer lifecycle management uses event-driven triggers. The orchestration layer must support all four.</p>
</blockquote>
<hr>
</section>
</section>
<section id="model-context-protocol---the-agent-language" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="model-context-protocol---the-agent-language"><span class="header-section-number">3</span> Model Context Protocol - The Agent Language</h2>
<p><strong>Opening:</strong> “Agents need a common language. Without it, Agent A’s output becomes garbage to Agent B.”</p>
<section id="what-mcp-solves" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="what-mcp-solves"><span class="header-section-number">3.1</span> What MCP Solves</h3>
<ul>
<li><strong>Context Sharing:</strong> Agent A’s analysis (unstructured text) → structured data Agent B can reason over</li>
<li><strong>Tool Invocation:</strong> Agent B requests Agent C to run sanctions check → receives results in standardized format</li>
<li><strong>State Management:</strong> Workflow pauses (customer uploads additional doc) → resumes exactly where it left off</li>
</ul>
</section>
<section id="mcp-vs.-traditional-apis" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="mcp-vs.-traditional-apis"><span class="header-section-number">3.2</span> MCP vs.&nbsp;Traditional APIs</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 77%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Traditional API</th>
<th>MCP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Data transfer</td>
<td><strong>Context transfer</strong></td>
</tr>
<tr class="even">
<td>“Here’s a JSON blob”</td>
<td><strong>“Here’s what I learned, why it matters, what’s uncertain”</strong></td>
</tr>
<tr class="odd">
<td>Static schemas</td>
<td><strong>Semantic understanding</strong></td>
</tr>
<tr class="even">
<td>Point-to-point</td>
<td><strong>Many-to-many agent communication</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="concrete-example" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="concrete-example"><span class="header-section-number">3.3</span> Concrete Example</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">Credit</span> <span class="er">Analysis</span> <span class="er">Agent</span> <span class="er">→</span> <span class="er">MCP</span> <span class="er">message</span> <span class="er">to</span> <span class="er">Compliance</span> <span class="er">Agent:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"applicant_id"</span><span class="fu">:</span> <span class="st">"12345"</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"credit_score"</span><span class="fu">:</span> <span class="dv">720</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"debt_to_income"</span><span class="fu">:</span> <span class="dv">38</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"risk_tier"</span><span class="fu">:</span> <span class="st">"medium"</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"uncertainty"</span><span class="fu">:</span> <span class="st">"Recent job change (3 months ago), income verification pending"</span><span class="fu">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"action_needed"</span><span class="fu">:</span> <span class="st">"sanctions_screening, employment_verification"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="er">Compliance</span> <span class="er">Agent</span> <span class="er">response:</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"sanctions_status"</span><span class="fu">:</span> <span class="st">"clear"</span><span class="fu">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"employment_verified"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"verification_source"</span><span class="fu">:</span> <span class="st">"The Work Number API"</span><span class="fu">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"proceed"</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="why-this-matters" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="why-this-matters"><span class="header-section-number">3.4</span> Why This Matters</h3>
<ul>
<li>Without MCP: Each vendor’s agents speak different dialects → integration nightmare</li>
<li>With MCP: Plug-and-play agent networks, vendor interoperability</li>
</ul>
</section>
<section id="current-state" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="current-state"><span class="header-section-number">3.5</span> Current State</h3>
<ul>
<li>MCP still emerging (Anthropic released spec Nov 2024)</li>
<li>Not yet industry standard, but momentum building</li>
<li>Banks should evaluate MCP support when selecting agent platforms</li>
</ul>
<hr>
</section>
</section>
<section id="orchestration-architecture---the-control-center" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="orchestration-architecture---the-control-center"><span class="header-section-number">4</span> Orchestration Architecture - The Control Center</h2>
<p>Frame as <strong>“The Banking Orchestration Stack”</strong> - 4 layers:</p>
<section id="layer-1-workflow-engine" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="layer-1-workflow-engine"><span class="header-section-number">4.1</span> Layer 1: Workflow Engine</h3>
<ul>
<li>Defines agent sequences, parallelism, conditionals</li>
<li>Banking requirement: Handle long-running workflows (loan application takes days/weeks, not minutes)</li>
<li>Must support: Human-in-loop pauses, external event triggers (customer uploads doc), deadline management (regulatory timelines)</li>
</ul>
</section>
<section id="layer-2-context-broker" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="layer-2-context-broker"><span class="header-section-number">4.2</span> Layer 2: Context Broker</h3>
<ul>
<li>Manages data flow between agents</li>
<li>Banking requirement: Enforce data access controls (credit agent can’t see full SSN, only masked version)</li>
<li>Must track: Data lineage (which agent saw what data, when), consent management (customer approved data sharing)</li>
</ul>
</section>
<section id="layer-3-state-management" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="layer-3-state-management"><span class="header-section-number">4.3</span> Layer 3: State Management</h3>
<ul>
<li>Tracks workflow progress, maintains context across sessions</li>
<li>Banking requirement: Persist state for audit (7-year retention for loan decisions)</li>
<li>Must support: Workflow rollback (cancel loan application mid-stream), partial restarts (re-run compliance after new info)</li>
</ul>
</section>
<section id="layer-4-monitoring-observability" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="layer-4-monitoring-observability"><span class="header-section-number">4.4</span> Layer 4: Monitoring &amp; Observability</h3>
<ul>
<li>Real-time dashboards: Active workflows, agent performance, error rates</li>
<li>Banking requirement: Detect regulatory violations in real-time (fair lending disparities, data retention breaches)</li>
<li>Must alert on: Stuck workflows (&gt;SLA), anomalous patterns (sudden spike in denials), agent drift (performance degradation)</li>
</ul>
</section>
<section id="error-handling---banking-specific" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="error-handling---banking-specific"><span class="header-section-number">4.5</span> Error Handling - Banking-Specific</h3>
<ul>
<li><strong>Transient failures:</strong> Retry with exponential backoff (API timeout, temporary data unavailable)</li>
<li><strong>Permanent failures:</strong> Route to human queue (agent can’t determine income verification method)</li>
<li><strong>Regulatory exceptions:</strong> Immediate escalation + workflow pause (OFAC hit, fair lending flag)</li>
</ul>
</section>
<section id="integration-points" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="integration-points"><span class="header-section-number">4.6</span> Integration Points</h3>
<ul>
<li><strong>Upstream:</strong> Core banking systems (deposits, loans, CRM)</li>
<li><strong>Downstream:</strong> Agent platforms (Bedrock, Salesforce, custom)</li>
<li><strong>Sidecar:</strong> Compliance systems (model risk management, audit logs)</li>
</ul>
<hr>
</section>
</section>
<section id="deep-dive-use-case---corporate-loan-origination" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="deep-dive-use-case---corporate-loan-origination"><span class="header-section-number">5</span> Deep-Dive Use Case - Corporate Loan Origination</h2>
<p><strong>Scenario:</strong> “Supremo Corporation applies for €50M credit facility for European expansion. The orchestration system coordinates 7 agents across 3 departments over 5 business days.”</p>
<section id="act-1-data-gathering-parallel" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="act-1-data-gathering-parallel"><span class="header-section-number">5.1</span> Act 1: Data Gathering (Parallel)</h3>
<ul>
<li><strong>Application Intake Agent</strong> extracts structured data from PDF application</li>
<li><strong>Financial Statement Agent</strong> ingests 3 years of audited financials</li>
<li><strong>Market Research Agent</strong> pulls economic data on target European markets</li>
<li>All three run in parallel, fan-in when complete</li>
</ul>
</section>
<section id="act-2-analysis-sequential-pipeline" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="act-2-analysis-sequential-pipeline"><span class="header-section-number">5.2</span> Act 2: Analysis (Sequential Pipeline)</h3>
<ul>
<li><strong>Credit Analysis Agent</strong> receives fan-in results → generates risk score, leverage ratios, cash flow projections</li>
<li><strong>Industry Benchmarking Agent</strong> compares Supremo to peer companies → identifies outliers</li>
<li><strong>Credit Memo Agent</strong> drafts preliminary write-up with analysis + data citations</li>
</ul>
</section>
<section id="act-3-compliance-risk-parallel-with-hierarchical" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="act-3-compliance-risk-parallel-with-hierarchical"><span class="header-section-number">5.3</span> Act 3: Compliance &amp; Risk (Parallel with Hierarchical)</h3>
<ul>
<li><strong>Sanctions Screening Agent</strong> checks Supremo + all beneficial owners against OFAC/EU lists</li>
<li><strong>Country Risk Agent</strong> assesses political/economic stability of target markets</li>
<li><strong>Concentration Risk Agent</strong> checks bank’s existing exposure to Supremo’s industry/geography</li>
<li><strong>Supervisor Agent</strong> aggregates all risk flags → escalates to human if any red flags</li>
</ul>
</section>
<section id="act-4-pricing-structuring-sequential" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="act-4-pricing-structuring-sequential"><span class="header-section-number">5.4</span> Act 4: Pricing &amp; Structuring (Sequential)</h3>
<ul>
<li><strong>Pricing Agent</strong> determines rate based on: credit risk score, market conditions, relationship value, concentration risk premium</li>
<li><strong>Structuring Agent</strong> recommends covenants, collateral requirements, amortization schedule</li>
<li><strong>Profitability Agent</strong> calculates risk-adjusted return on capital (RAROC) → flags if below hurdle rate</li>
</ul>
</section>
<section id="act-5-documentation-approval-event-driven" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="act-5-documentation-approval-event-driven"><span class="header-section-number">5.5</span> Act 5: Documentation &amp; Approval (Event-Driven)</h3>
<ul>
<li><strong>Approval Routing Agent</strong> determines approval authority (€50M requires C-suite, board notification)</li>
<li><strong>Document Generation Agent</strong> produces credit agreement, term sheet, compliance certifications</li>
<li><strong>Notification Agent</strong> alerts relationship manager, client, credit committee</li>
</ul>
</section>
<section id="human-touchpoints" class="level3" data-number="5.6">
<h3 data-number="5.6" class="anchored" data-anchor-id="human-touchpoints"><span class="header-section-number">5.6</span> Human Touchpoints</h3>
<ul>
<li>Credit officer reviews Credit Memo Agent output (augments with relationship context)</li>
<li>Chief Credit Officer approves final terms (agent recommendation + override authority)</li>
<li>Relationship manager negotiates final terms with client (agents provide real-time pricing scenarios)</li>
</ul>
</section>
<section id="orchestration-complexity" class="level3" data-number="5.7">
<h3 data-number="5.7" class="anchored" data-anchor-id="orchestration-complexity"><span class="header-section-number">5.7</span> Orchestration Complexity</h3>
<ul>
<li>7 agents, 23 discrete tasks, 4 decision points, 3 human reviews</li>
<li>Without orchestration: 3-4 weeks, 15-20 emails, multiple spreadsheets, version control chaos</li>
<li>With orchestration: 5 days, 2 human meetings, single source of truth, full audit trail</li>
</ul>
</section>
<section id="governance-audit-trail" class="level3" data-number="5.8">
<h3 data-number="5.8" class="anchored" data-anchor-id="governance-audit-trail"><span class="header-section-number">5.8</span> Governance Audit Trail</h3>
<pre><code>[Agent: Credit Analysis] Input: Financials, Market Data | Output: Risk Score 6.2/10 | Reasoning: "Strong cash flow offset by high leverage (3.2x)"
[Agent: Pricing] Input: Risk Score 6.2 | Output: Rate SOFR + 275bps | Reasoning: "Peer average SOFR + 250, +25 for concentration risk"
[Human: Chief Credit Officer] Override: Rate SOFR + 250bps | Reasoning: "Strategic relationship, waive concentration premium"</code></pre>
<hr>
</section>
</section>
<section id="governance-for-multi-agent-systems" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="governance-for-multi-agent-systems"><span class="header-section-number">6</span> Governance for Multi-Agent Systems</h2>
<p>Focus ONLY on <strong>orchestration-specific governance</strong> (different from single-agent governance in Blog 1)</p>
<section id="new-governance-requirements" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="new-governance-requirements"><span class="header-section-number">6.1</span> New Governance Requirements</h3>
<section id="agent-dependency-mapping" class="level4" data-number="6.1.1">
<h4 data-number="6.1.1" class="anchored" data-anchor-id="agent-dependency-mapping"><span class="header-section-number">6.1.1</span> 1. Agent Dependency Mapping</h4>
<ul>
<li>Which agents rely on which other agents?</li>
<li>What happens if Agent B is unavailable when Agent A needs it?</li>
<li>Fallback chains: Primary agent → Backup agent → Human escalation</li>
</ul>
</section>
<section id="inter-agent-permission-model" class="level4" data-number="6.1.2">
<h4 data-number="6.1.2" class="anchored" data-anchor-id="inter-agent-permission-model"><span class="header-section-number">6.1.2</span> 2. Inter-Agent Permission Model</h4>
<ul>
<li>Agent A can invoke Agent B for sanctions screening BUT NOT for credit decisions</li>
<li>Prevents agents from “social engineering” each other (Agent A tricks Agent B into approving something outside policy)</li>
</ul>
</section>
<section id="workflow-level-audit" class="level4" data-number="6.1.3">
<h4 data-number="6.1.3" class="anchored" data-anchor-id="workflow-level-audit"><span class="header-section-number">6.1.3</span> 3. Workflow-Level Audit</h4>
<ul>
<li>Beyond individual agent logs (covered in Blog 1)</li>
<li>End-to-end workflow trace: Every handoff, every decision, every data transformation</li>
<li>Regulatory requirement: “Show me how you reached the denial decision across all 7 agents”</li>
</ul>
</section>
<section id="orchestration-testing" class="level4" data-number="6.1.4">
<h4 data-number="6.1.4" class="anchored" data-anchor-id="orchestration-testing"><span class="header-section-number">6.1.4</span> 4. Orchestration Testing</h4>
<ul>
<li>Unit tests: Individual agents work correctly</li>
<li>Integration tests: Agents hand off properly (Agent A’s output format matches Agent B’s input requirements)</li>
<li>Chaos tests: Kill Agent C mid-workflow → does orchestration recover gracefully or crash?</li>
<li>Bias tests: Do multi-agent workflows produce fair lending violations at portfolio scale?</li>
</ul>
</section>
<section id="version-control" class="level4" data-number="6.1.5">
<h4 data-number="6.1.5" class="anchored" data-anchor-id="version-control"><span class="header-section-number">6.1.5</span> 5. Version Control</h4>
<ul>
<li>Agent A v1.2 works with Agent B v2.0 but NOT v1.8</li>
<li>Orchestration layer manages compatibility matrix</li>
<li>Controlled rollouts: Deploy Agent A v1.3 to 10% of workflows, monitor for errors, rollback if needed</li>
</ul>
</section>
</section>
<section id="comparison-single-agent-vs.-multi-agent-governance" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="comparison-single-agent-vs.-multi-agent-governance"><span class="header-section-number">6.2</span> Comparison: Single Agent vs.&nbsp;Multi-Agent Governance</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 27%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th>Governance Aspect</th>
<th>Single Agent (Blog 1)</th>
<th>Multi-Agent Orchestration (This Blog)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Risk focus</td>
<td>Agent makes wrong decision</td>
<td>Agents don’t communicate properly → wrong decision</td>
</tr>
<tr class="even">
<td>Audit trail</td>
<td>Agent decision log</td>
<td>Full workflow trace across agents</td>
</tr>
<tr class="odd">
<td>Testing</td>
<td>Model validation</td>
<td>Integration + chaos engineering</td>
</tr>
<tr class="even">
<td>Permissions</td>
<td>What data can agent access</td>
<td>What other agents can this agent invoke</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="vendor-landscape-build-vs.-buy" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="vendor-landscape-build-vs.-buy"><span class="header-section-number">7</span> Vendor Landscape &amp; Build vs.&nbsp;Buy</h2>
<section id="the-build-vs.-buy-decision-matrix" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="the-build-vs.-buy-decision-matrix"><span class="header-section-number">7.1</span> The Build vs.&nbsp;Buy Decision Matrix</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 31%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th>Factor</th>
<th>Platform (Buy)</th>
<th>Custom Framework (Build)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Time to production</strong></td>
<td>3-6 months</td>
<td>9-18 months</td>
</tr>
<tr class="even">
<td><strong>Orchestration complexity</strong></td>
<td>Limited to platform patterns</td>
<td>Full flexibility</td>
</tr>
<tr class="odd">
<td><strong>Vendor lock-in risk</strong></td>
<td>High</td>
<td>None</td>
</tr>
<tr class="even">
<td><strong>Ongoing maintenance</strong></td>
<td>Vendor handles</td>
<td>Your team owns</td>
</tr>
<tr class="odd">
<td><strong>Banking-specific features</strong></td>
<td>Generic workflows</td>
<td>Tailored to your processes</td>
</tr>
<tr class="even">
<td><strong>Regulatory compliance</strong></td>
<td>Vendor’s responsibility (but you’re still accountable)</td>
<td>Fully under your control</td>
</tr>
</tbody>
</table>
</section>
<section id="platform-solutions-buy" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="platform-solutions-buy"><span class="header-section-number">7.2</span> Platform Solutions (Buy)</h3>
<section id="servicenow-ai-platform" class="level4" data-number="7.2.1">
<h4 data-number="7.2.1" class="anchored" data-anchor-id="servicenow-ai-platform"><span class="header-section-number">7.2.1</span> ServiceNow AI Platform</h4>
<ul>
<li><strong>Strength:</strong> Cross-vendor orchestration (any agent, any model)</li>
<li><strong>Banking fit:</strong> Strong for IT service management workflows, weaker for core banking</li>
<li><strong>Governance:</strong> Built-in audit trails, approval workflows</li>
<li><strong>Consideration:</strong> Heavy enterprise licensing, steep learning curve</li>
</ul>
</section>
<section id="amazon-bedrock-multi-agent-collaboration" class="level4" data-number="7.2.2">
<h4 data-number="7.2.2" class="anchored" data-anchor-id="amazon-bedrock-multi-agent-collaboration"><span class="header-section-number">7.2.2</span> Amazon Bedrock (Multi-Agent Collaboration)</h4>
<ul>
<li><strong>Strength:</strong> Native AWS integration, scales to high volume</li>
<li><strong>Banking fit:</strong> Good for cloud-native banks, harder for on-prem hybrid</li>
<li><strong>Governance:</strong> CloudWatch monitoring, IAM for agent permissions</li>
<li><strong>Consideration:</strong> Locked into AWS ecosystem</li>
</ul>
</section>
<section id="salesforce-agentforce" class="level4" data-number="7.2.3">
<h4 data-number="7.2.3" class="anchored" data-anchor-id="salesforce-agentforce"><span class="header-section-number">7.2.3</span> Salesforce Agentforce</h4>
<ul>
<li><strong>Strength:</strong> Pre-built banking agents (wealth management, service, sales)</li>
<li><strong>Banking fit:</strong> Excellent for CRM-centric workflows (relationship management, servicing)</li>
<li><strong>Governance:</strong> Salesforce Shield for audit compliance</li>
<li><strong>Consideration:</strong> Weak for core banking processes (loans, deposits, payments)</li>
</ul>
</section>
</section>
<section id="custom-frameworks-build" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="custom-frameworks-build"><span class="header-section-number">7.3</span> Custom Frameworks (Build)</h3>
<section id="langgraph-open-source" class="level4" data-number="7.3.1">
<h4 data-number="7.3.1" class="anchored" data-anchor-id="langgraph-open-source"><span class="header-section-number">7.3.1</span> LangGraph (Open Source)</h4>
<ul>
<li><strong>Strength:</strong> Maximum flexibility, agent-as-code</li>
<li><strong>Banking fit:</strong> Can model any banking workflow</li>
<li><strong>Governance:</strong> You build all controls yourself</li>
<li><strong>Consideration:</strong> Requires strong ML engineering team</li>
</ul>
</section>
<section id="microsoft-semantic-kernel" class="level4" data-number="7.3.2">
<h4 data-number="7.3.2" class="anchored" data-anchor-id="microsoft-semantic-kernel"><span class="header-section-number">7.3.2</span> Microsoft Semantic Kernel</h4>
<ul>
<li><strong>Strength:</strong> Language-agnostic (C#, Python, Java), enterprise integration</li>
<li><strong>Banking fit:</strong> Works with Azure AI services + on-prem systems</li>
<li><strong>Governance:</strong> Integrate with your existing compliance tools</li>
<li><strong>Consideration:</strong> Less mature than LangGraph, smaller community</li>
</ul>
</section>
</section>
<section id="decision-framework-for-banks" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="decision-framework-for-banks"><span class="header-section-number">7.4</span> Decision Framework for Banks</h3>
<p><strong>Start with Platform IF:</strong> - You’re prioritizing speed to market (pilot in 3-6 months) - You have standard workflows (consumer lending, servicing) - You lack ML engineering capacity</p>
<p><strong>Build Custom IF:</strong> - You have unique competitive workflows - You have strong ML engineering team - You need full regulatory control - You’re making multi-decade infrastructure investment</p>
<p><strong>Hybrid Approach (Recommended):</strong> - Use platform for Experience Agents (customer-facing, low risk) - Build custom for Domain Agents (core banking, high risk, competitive differentiation) - Orchestration layer connects both</p>
<hr>
</section>
</section>
<section id="common-pitfalls-to-avoid" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="common-pitfalls-to-avoid"><span class="header-section-number">8</span> Common Pitfalls to Avoid</h2>
<ul>
<li>❌ Starting with most complex workflow → Start simple, prove orchestration value</li>
<li>❌ Over-engineering governance upfront → Implement minimum controls, iterate</li>
<li>❌ Ignoring monitoring → You can’t improve what you don’t measure</li>
<li>❌ Treating orchestration as IT project → This is business process transformation, needs business owners</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>